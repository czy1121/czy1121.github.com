<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="android,cookie,fullscreen,javascript,webview," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="相关API相关类介绍 WebResourceRequest 添加于API21，封装了一个Web资源的请求信息，包含：请求地址，请求方法，请求头，是否主框架，是否用户点击，是否重定向 WebResourceResponse 封装了一个Web资源的响应信息，包含：响应数据流，编码，MIME类型，API21后添加了响应头，状态码与状态描述 WebResourceError 添加于API23，封装了一个W">
<meta name="keywords" content="android,cookie,fullscreen,javascript,webview">
<meta property="og:type" content="article">
<meta property="og:title" content="Android WebView 详解 ">
<meta property="og:url" content="http://reezy.me/p/20170515/android-webview/index.html">
<meta property="og:site_name" content="RE:从零开始的EZY">
<meta property="og:description" content="相关API相关类介绍 WebResourceRequest 添加于API21，封装了一个Web资源的请求信息，包含：请求地址，请求方法，请求头，是否主框架，是否用户点击，是否重定向 WebResourceResponse 封装了一个Web资源的响应信息，包含：响应数据流，编码，MIME类型，API21后添加了响应头，状态码与状态描述 WebResourceError 添加于API23，封装了一个W">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2017-08-23T21:15:29.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android WebView 详解 ">
<meta name="twitter:description" content="相关API相关类介绍 WebResourceRequest 添加于API21，封装了一个Web资源的请求信息，包含：请求地址，请求方法，请求头，是否主框架，是否用户点击，是否重定向 WebResourceResponse 封装了一个Web资源的响应信息，包含：响应数据流，编码，MIME类型，API21后添加了响应头，状态码与状态描述 WebResourceError 添加于API23，封装了一个W">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: 'undefined',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://reezy.me/p/20170515/android-webview/"/>





  <title>Android WebView 详解  | RE:从零开始的EZY</title>
  









<script>
  	var _mtac = {};
  	(function() {
  		var mta = document.createElement("script");
  		mta.src = "https://pingjs.qq.com/h5/stats.js?v2.0.4";
  		mta.setAttribute("name", "MTAH5");
  		mta.setAttribute("sid", "500511690");

  		var s = document.getElementsByTagName("script")[0];
  		s.parentNode.insertBefore(mta, s);
  	})();
</script>






</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">RE:从零开始的EZY</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://reezy.me/p/20170515/android-webview/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ezy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RE:从零开始的EZY">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Android WebView 详解 </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-15T00:00:00+08:00">
                2017-05-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/开发/" itemprop="url" rel="index">
                    <span itemprop="name">开发</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="相关API"><a href="#相关API" class="headerlink" title="相关API"></a>相关API</h2><h3 id="相关类介绍"><a href="#相关类介绍" class="headerlink" title="相关类介绍"></a>相关类介绍</h3><ul>
<li><a href="https://developer.android.com/reference/android/webkit/WebResourceRequest.html" target="_blank" rel="external">WebResourceRequest</a> 添加于API21，封装了一个Web资源的请求信息，包含：请求地址，请求方法，请求头，是否主框架，是否用户点击，是否重定向</li>
<li><a href="https://developer.android.com/reference/android/webkit/WebResourceResponse.html" target="_blank" rel="external">WebResourceResponse</a> 封装了一个Web资源的响应信息，包含：响应数据流，编码，MIME类型，API21后添加了响应头，状态码与状态描述</li>
<li><a href="https://developer.android.com/reference/android/webkit/WebResourceError.html" target="_blank" rel="external">WebResourceError</a> 添加于API23，封装了一个Web资源的错误信息，包含错误码和描述</li>
<li><a href="https://developer.android.com/reference/android/webkit/CookieManager.html" target="_blank" rel="external">CookieManager</a> 管理用于WebView的cookies。。</li>
<li><a href="https://developer.android.com/reference/android/webkit/WebViewDatabase.html" target="_blank" rel="external">WebViewDatabase</a> 存储与管理以下几类浏览数据：<ul>
<li>表单自动填充的的用户名与密码</li>
<li>HTTP认证的用户名与密码</li>
<li>曾经输入过的文本(比如自动完成)</li>
</ul>
</li>
<li><a href="https://developer.android.com/reference/android/webkit/WebStorage.html" target="_blank" rel="external">WebStorage</a> 用于管理WebView提供的JS存储API，比如Application Cache API，Web SQL Database API，HTML5 Web Storage API</li>
<li><a href="https://developer.android.com/reference/android/webkit/GeolocationPermissions.html" target="_blank" rel="external">GeolocationPermissions</a> 用于管理WebView的JS Geolocation API</li>
<li><a href="https://developer.android.com/reference/android/webkit/HttpAuthHandler.html" target="_blank" rel="external">HttpAuthHandler</a> 表示一个HTTP认证请求，提供了方法操作(proceed/cancel)请求 </li>
<li><a href="https://developer.android.com/reference/android/webkit/SslErrorHandler.html" target="_blank" rel="external">SslErrorHandler</a> 表示一个处理SSL错误的请求，提供了方法操作(proceed/cancel)请求 </li>
<li><a href="https://developer.android.com/reference/android/webkit/ClientCertRequest.html" target="_blank" rel="external">ClientCertRequest</a> 表示一个证书请求，提供了方法操作(proceed/cancel/ignore)请求 </li>
<li><a href="https://developer.android.com/reference/android/webkit/JsResult.html" target="_blank" rel="external">JsResult</a> 用于处理底层JS发起的请求，为客户端提供一些方法指明应进行的操作，比如确认或取消。</li>
</ul>
<a id="more"></a>
<h3 id="WebView"><a href="#WebView" class="headerlink" title="WebView"></a>WebView</h3><p>基本</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 获取当前页面的URL</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getUrl</span><span class="params">()</span></span>;</div><div class="line"><span class="comment">// 获取当前页面的原始URL(重定向后可能当前url不同)</span></div><div class="line"><span class="comment">// 就是http headers的Referer参数，loadUrl时为null</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getOriginalUrl</span><span class="params">()</span></span>;</div><div class="line"><span class="comment">// 获取当前页面的标题</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span></span>;</div><div class="line"><span class="comment">// 获取当前页面的favicon</span></div><div class="line"><span class="function"><span class="keyword">public</span> Bitmap <span class="title">getFavicon</span><span class="params">()</span></span>;</div><div class="line"><span class="comment">// 获取当前页面的加载进度</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getProgress</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line"><span class="comment">// 通知WebView内核网络状态</span></div><div class="line"><span class="comment">// 用于设置JS属性`window.navigator.isOnline`和产生HTML5事件`online/offline`</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNetworkAvailable</span><span class="params">(<span class="keyword">boolean</span> networkUp)</span></span></div><div class="line"><span class="function"></span></div><div class="line"><span class="function"><span class="comment">// 设置初始缩放比例</span></span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setInitialScale</span><span class="params">(<span class="keyword">int</span> scaleInPercent)</span>；</span></div></pre></td></tr></table></figure>
<p>加载网页</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 加载URL指定的网页</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadUrl</span><span class="params">(String url)</span></span>;</div><div class="line"><span class="comment">// 携带http headers加载URL指定的网页</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadUrl</span><span class="params">(String url, Map&lt;String, String&gt; additionalHttpHeaders)</span></span>;</div><div class="line"><span class="comment">// 使用POST请求加载指定的网页</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postUrl</span><span class="params">(String url, <span class="keyword">byte</span>[] postData)</span></span>;</div><div class="line"><span class="comment">// 重新加载当前网页</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reload</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line"><span class="comment">// 加载内容</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadData</span><span class="params">(String data, String mimeType, String encoding)</span></span>;</div><div class="line"><span class="comment">// 使用baseUrl加载内容</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadDataWithBaseURL</span><span class="params">(String baseUrl, String data, String mimeType, String encoding, String historyUrl)</span></span>;</div></pre></td></tr></table></figure>
<p>Javascript</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 注入Javascript对象</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addJavascriptInterface</span><span class="params">(Object object, String name)</span></span>;</div><div class="line"><span class="comment">// 移除已注入的Javascript对象，下次加载或刷新页面时生效</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeJavascriptInterface</span><span class="params">(String name)</span></span>;</div><div class="line"></div><div class="line"><span class="comment">// 对传入的JS表达式求值，通过resultCallback返回结果</span></div><div class="line"><span class="comment">// 此函数添加于API19，必须在UI线程中调用，回调也将在UI线程</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">evaluateJavascript</span><span class="params">(String script, ValueCallback&lt;String&gt; resultCallback)</span></span></div></pre></td></tr></table></figure>
<p>导航(前进后退)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 复制一份BackForwardList</span></div><div class="line"><span class="function"><span class="keyword">public</span> WebBackForwardList <span class="title">copyBackForwardList</span><span class="params">()</span></span>;</div><div class="line"><span class="comment">// 是否可后退</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canGoBack</span><span class="params">()</span></span>;</div><div class="line"><span class="comment">// 是否可前进</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canGoForward</span><span class="params">()</span></span>;</div><div class="line"><span class="comment">// 是否可前进/后退steps页，大于0表示前进小于0表示后退</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canGoBackOrForward</span><span class="params">(<span class="keyword">int</span> steps)</span></span>;</div><div class="line"></div><div class="line"><span class="comment">// 后退一页</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">goBack</span><span class="params">()</span></span>;</div><div class="line"><span class="comment">// 前进一页</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">goForward</span><span class="params">()</span></span>;</div><div class="line"><span class="comment">// 前进/后退steps页，大于0表示前进小于0表示后退</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">goBackOrForward</span><span class="params">(<span class="keyword">int</span> steps)</span></span>;</div><div class="line"></div><div class="line"><span class="comment">// 清除当前webview访问的历史记录</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearHistory</span><span class="params">()</span></span>;</div></pre></td></tr></table></figure>
<p>网页查找功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 设置网页查找结果回调</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFindListener</span><span class="params">(FindListener listener)</span></span>;</div><div class="line"><span class="comment">// 异步执行查找网页内包含的字符串并设置高亮，查找结果会回调.</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAllAsync</span> <span class="params">(String find)</span></span>;</div><div class="line"><span class="comment">// 查找下一个匹配的字符串</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findNext</span> <span class="params">(<span class="keyword">boolean</span> forward)</span></span>;</div><div class="line"><span class="comment">// 清除网页查找的高亮匹配字符串</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearMatches</span><span class="params">()</span></span>;</div></pre></td></tr></table></figure>
<p>截屏/翻页/缩放</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 网页截屏并保存到指定文件</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveWebArchive</span><span class="params">(String filename)</span></span>;</div><div class="line"><span class="comment">// 网页截屏并保存到文件</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveWebArchive</span><span class="params">(String basename, <span class="keyword">boolean</span> autoname, ValueCallback&lt;String&gt; callback)</span>；</span></div><div class="line"><span class="function"></span></div><div class="line"><span class="function"><span class="comment">// 上翻一页，即向上滚动WebView高度的一半</span></span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pageUp</span><span class="params">(<span class="keyword">boolean</span> top)</span></span>;</div><div class="line"><span class="comment">// 下翻一页，即向下滚动WebView高度的一半</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pageDown</span><span class="params">(<span class="keyword">boolean</span> bottom)</span></span>;</div><div class="line"></div><div class="line"><span class="comment">// 缩放</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">zoomBy</span><span class="params">(<span class="keyword">float</span> factor)</span></span>;</div><div class="line"><span class="comment">// 放大</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">zoomIn</span><span class="params">()</span></span>;</div><div class="line"><span class="comment">// 缩放</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">zoomOut</span><span class="params">()</span></span>;</div></pre></td></tr></table></figure>
<p>其它</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 清除网页缓存，由于内核缓存是全局的因此这个方法不仅仅针对webview而是针对整个应用程序</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearCache</span><span class="params">(<span class="keyword">boolean</span> includeDiskFiles)</span></span>;</div><div class="line"><span class="comment">// 清除自动完成填充的表单数据</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearFormData</span><span class="params">()</span></span>;</div><div class="line"><span class="comment">// 清除SSL偏好</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearSslPreferences</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line"><span class="comment">// 查询文档中是否有图片，查询结果将被发送到msg.getTarget()</span></div><div class="line"><span class="comment">// 如果包含图片，msg.arg1 为1，否则为0</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">documentHasImages</span><span class="params">(Message msg)</span></span>;</div><div class="line"></div><div class="line"><span class="comment">// 请求最近轻叩(tapped)的 锚点/图像 元素的URL，查询结果将被发送到msg.getTarget()</span></div><div class="line"><span class="comment">// msg.getData()中的url是锚点的href属性，title是锚点的文本，src是图像的src</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">requestFocusNodeHref</span><span class="params">(Message msg)</span></span>;</div><div class="line"></div><div class="line"><span class="comment">// 请求最近触摸(touched)的 图像元素的URL，查询结果将被发送到msg.getTarget()</span></div><div class="line"><span class="comment">// msg.getData()中的url是图像链接</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">requestImageRef</span><span class="params">(Message msg)</span> </span></div><div class="line"><span class="function"></span></div><div class="line"><span class="function"></span></div><div class="line"><span class="function"><span class="comment">// 清除证书请求偏好，添加于API21</span></span></div><div class="line"><span class="function"><span class="comment">// 在WebView收到`android.security.STORAGE_CHANGED` Intent时会自动清除</span></span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">clearClientCertPreferences</span><span class="params">(Runnable onCleared)</span></span></div><div class="line"><span class="function"></span></div><div class="line"><span class="function"><span class="comment">// 开启网页内容(js,css,html...)调试模式，添加于API19</span></span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setWebContentsDebuggingEnabled</span><span class="params">(<span class="keyword">boolean</span> enabled)</span></span></div></pre></td></tr></table></figure>
<h3 id="WebSettings"><a href="#WebSettings" class="headerlink" title="WebSettings"></a>WebSettings</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line">WebSettings settings = web.getSettings();</div><div class="line"></div><div class="line"><span class="comment">// 存储(storage)</span></div><div class="line"><span class="comment">// 启用HTML5 DOM storage API，默认值 false</span></div><div class="line">settings.setDomStorageEnabled(<span class="keyword">true</span>); </div><div class="line"><span class="comment">// 启用Web SQL Database API，这个设置会影响同一进程内的所有WebView，默认值 false</span></div><div class="line"><span class="comment">// 此API已不推荐使用，参考：https://www.w3.org/TR/webdatabase/</span></div><div class="line">settings.setDatabaseEnabled(<span class="keyword">true</span>);  </div><div class="line"><span class="comment">// 启用Application Caches API，必需设置有效的缓存路径才能生效，默认值 false</span></div><div class="line"><span class="comment">// 此API已废弃，参考：https://developer.mozilla.org/zh-CN/docs/Web/HTML/Using_the_application_cache</span></div><div class="line">settings.setAppCacheEnabled(<span class="keyword">true</span>); </div><div class="line">settings.setAppCachePath(context.getCacheDir().getAbsolutePath());</div><div class="line"></div><div class="line"><span class="comment">// 定位(location)</span></div><div class="line">settings.setGeolocationEnabled(<span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="comment">// 是否保存表单数据</span></div><div class="line">settings.setSaveFormData(<span class="keyword">true</span>);</div><div class="line"><span class="comment">// 是否当webview调用requestFocus时为页面的某个元素设置焦点，默认值 true</span></div><div class="line">settings.setNeedInitialFocus(<span class="keyword">true</span>);  </div><div class="line"></div><div class="line"><span class="comment">// 是否支持viewport属性，默认值 false</span></div><div class="line"><span class="comment">// 页面通过`&lt;meta name="viewport" ... /&gt;`自适应手机屏幕</span></div><div class="line">settings.setUseWideViewPort(<span class="keyword">true</span>);</div><div class="line"><span class="comment">// 是否使用overview mode加载页面，默认值 false</span></div><div class="line"><span class="comment">// 当页面宽度大于WebView宽度时，缩小使页面宽度等于WebView宽度</span></div><div class="line">settings.setLoadWithOverviewMode(<span class="keyword">true</span>);</div><div class="line"><span class="comment">// 布局算法</span></div><div class="line">settings.setLayoutAlgorithm(WebSettings.LayoutAlgorithm.NORMAL);</div><div class="line"></div><div class="line"><span class="comment">// 是否支持Javascript，默认值false</span></div><div class="line">settings.setJavaScriptEnabled(<span class="keyword">true</span>); </div><div class="line"><span class="comment">// 是否支持多窗口，默认值false</span></div><div class="line">settings.setSupportMultipleWindows(<span class="keyword">false</span>);</div><div class="line"><span class="comment">// 是否可用Javascript(window.open)打开窗口，默认值 false</span></div><div class="line">settings.setJavaScriptCanOpenWindowsAutomatically(<span class="keyword">false</span>);</div><div class="line"></div><div class="line"><span class="comment">// 资源访问</span></div><div class="line">settings.setAllowContentAccess(<span class="keyword">true</span>); <span class="comment">// 是否可访问Content Provider的资源，默认值 true</span></div><div class="line">settings.setAllowFileAccess(<span class="keyword">true</span>);    <span class="comment">// 是否可访问本地文件，默认值 true</span></div><div class="line"><span class="comment">// 是否允许通过file url加载的Javascript读取本地文件，默认值 false</span></div><div class="line">settings.setAllowFileAccessFromFileURLs(<span class="keyword">false</span>);  </div><div class="line"><span class="comment">// 是否允许通过file url加载的Javascript读取全部资源(包括文件,http,https)，默认值 false</span></div><div class="line">settings.setAllowUniversalAccessFromFileURLs(<span class="keyword">false</span>);</div><div class="line"></div><div class="line"><span class="comment">// 资源加载</span></div><div class="line">settings.setLoadsImagesAutomatically(<span class="keyword">true</span>); <span class="comment">// 是否自动加载图片</span></div><div class="line">settings.setBlockNetworkImage(<span class="keyword">false</span>);       <span class="comment">// 禁止加载网络图片</span></div><div class="line">settings.setBlockNetworkLoads(<span class="keyword">false</span>);       <span class="comment">// 禁止加载所有网络资源</span></div><div class="line"></div><div class="line"><span class="comment">// 缩放(zoom)</span></div><div class="line">settings.setSupportZoom(<span class="keyword">true</span>);          <span class="comment">// 是否支持缩放</span></div><div class="line">settings.setBuiltInZoomControls(<span class="keyword">false</span>); <span class="comment">// 是否使用内置缩放机制</span></div><div class="line">settings.setDisplayZoomControls(<span class="keyword">true</span>);  <span class="comment">// 是否显示内置缩放控件</span></div><div class="line"></div><div class="line"><span class="comment">// 默认文本编码，默认值 "UTF-8"</span></div><div class="line">settings.setDefaultTextEncodingName(<span class="string">"UTF-8"</span>);</div><div class="line">settings.setDefaultFontSize(<span class="number">16</span>);        <span class="comment">// 默认文字尺寸，默认值16，取值范围1-72</span></div><div class="line">settings.setDefaultFixedFontSize(<span class="number">16</span>);   <span class="comment">// 默认等宽字体尺寸，默认值16</span></div><div class="line">settings.setMinimumFontSize(<span class="number">8</span>);         <span class="comment">// 最小文字尺寸，默认值 8</span></div><div class="line">settings.setMinimumLogicalFontSize(<span class="number">8</span>);  <span class="comment">// 最小文字逻辑尺寸，默认值 8</span></div><div class="line">settings.setTextZoom(<span class="number">100</span>);              <span class="comment">// 文字缩放百分比，默认值 100</span></div><div class="line"></div><div class="line"><span class="comment">// 字体</span></div><div class="line">settings.setStandardFontFamily(<span class="string">"sans-serif"</span>);   <span class="comment">// 标准字体，默认值 "sans-serif"</span></div><div class="line">settings.setSerifFontFamily(<span class="string">"serif"</span>);           <span class="comment">// 衬线字体，默认值 "serif"</span></div><div class="line">settings.setSansSerifFontFamily(<span class="string">"sans-serif"</span>);  <span class="comment">// 无衬线字体，默认值 "sans-serif"</span></div><div class="line">settings.setFixedFontFamily(<span class="string">"monospace"</span>);       <span class="comment">// 等宽字体，默认值 "monospace"</span></div><div class="line">settings.setCursiveFontFamily(<span class="string">"cursive"</span>);       <span class="comment">// 手写体(草书)，默认值 "cursive"</span></div><div class="line">settings.setFantasyFontFamily(<span class="string">"fantasy"</span>);       <span class="comment">// 幻想体，默认值 "fantasy"</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;</div><div class="line">    <span class="comment">// 用户是否需要通过手势播放媒体(不会自动播放)，默认值 true</span></div><div class="line">    settings.setMediaPlaybackRequiresUserGesture(<span class="keyword">true</span>);</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;</div><div class="line">    <span class="comment">// 5.0以上允许加载http和https混合的页面(5.0以下默认允许，5.0+默认禁止)</span></div><div class="line">    settings.setMixedContentMode(WebSettings.MIXED_CONTENT_ALWAYS_ALLOW);</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) &#123;</div><div class="line">    <span class="comment">// 是否在离开屏幕时光栅化(会增加内存消耗)，默认值 false</span></div><div class="line">    settings.setOffscreenPreRaster(<span class="keyword">false</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (isNetworkConnected(context)) &#123;</div><div class="line">    <span class="comment">// 根据cache-control决定是否从网络上取数据</span></div><div class="line">    settings.setCacheMode(WebSettings.LOAD_DEFAULT);</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="comment">// 没网，离线加载，优先加载缓存(即使已经过期)</span></div><div class="line">    settings.setCacheMode(WebSettings.LOAD_CACHE_ELSE_NETWORK);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// deprecated</span></div><div class="line">settings.setRenderPriority(WebSettings.RenderPriority.HIGH);</div><div class="line">settings.setDatabasePath(context.getDir(<span class="string">"database"</span>, Context.MODE_PRIVATE).getPath());</div><div class="line">settings.setGeolocationDatabasePath(context.getFilesDir().getPath());</div></pre></td></tr></table></figure>
<p>通常大部分保持默认值就好了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">WebSettings settings = web.getSettings();</div><div class="line"><span class="comment">// 缓存(cache)</span></div><div class="line">settings.setAppCacheEnabled(<span class="keyword">true</span>);      <span class="comment">// 默认值 false</span></div><div class="line">settings.setAppCachePath(context.getCacheDir().getAbsolutePath());</div><div class="line"></div><div class="line"><span class="comment">// 存储(storage)</span></div><div class="line">settings.setDomStorageEnabled(<span class="keyword">true</span>);    <span class="comment">// 默认值 false</span></div><div class="line">settings.setDatabaseEnabled(<span class="keyword">true</span>);      <span class="comment">// 默认值 false </span></div><div class="line"> </div><div class="line"><span class="comment">// 是否支持viewport属性，默认值 false</span></div><div class="line"><span class="comment">// 页面通过`&lt;meta name="viewport" ... /&gt;`自适应手机屏幕</span></div><div class="line">settings.setUseWideViewPort(<span class="keyword">true</span>);</div><div class="line"><span class="comment">// 是否使用overview mode加载页面，默认值 false</span></div><div class="line"><span class="comment">// 当页面宽度大于WebView宽度时，缩小使页面宽度等于WebView宽度</span></div><div class="line">settings.setLoadWithOverviewMode(<span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="comment">// 是否支持Javascript，默认值false</span></div><div class="line">settings.setJavaScriptEnabled(<span class="keyword">true</span>);    </div><div class="line"></div><div class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;</div><div class="line">    <span class="comment">// 5.0以上允许加载http和https混合的页面(5.0以下默认允许，5.0+默认禁止)</span></div><div class="line">    settings.setMixedContentMode(WebSettings.MIXED_CONTENT_ALWAYS_ALLOW);</div><div class="line">&#125; </div><div class="line"></div><div class="line"><span class="keyword">if</span> (isNetworkConnected(context)) &#123;</div><div class="line">    <span class="comment">// 根据cache-control决定是否从网络上取数据</span></div><div class="line">    settings.setCacheMode(WebSettings.LOAD_DEFAULT);</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="comment">// 没网，离线加载，优先加载缓存(即使已经过期)</span></div><div class="line">    settings.setCacheMode(WebSettings.LOAD_CACHE_ELSE_NETWORK);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="WebViewClient"><a href="#WebViewClient" class="headerlink" title="WebViewClient"></a>WebViewClient</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 拦截页面加载，返回true表示宿主app拦截并处理了该url，否则返回false由当前WebView处理</span></div><div class="line"><span class="comment">// 此方法在API24被废弃，不处理POST请求</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view, String url)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 拦截页面加载，返回true表示宿主app拦截并处理了该url，否则返回false由当前WebView处理</span></div><div class="line"><span class="comment">// 此方法添加于API24，不处理POST请求，可拦截处理子frame的非http请求</span></div><div class="line"><span class="meta">@TargetApi</span>(Build.VERSION_CODES.N)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view, WebResourceRequest request)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> shouldOverrideUrlLoading(view, request.getUrl().toString());</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 此方法废弃于API21，调用于非UI线程</span></div><div class="line"><span class="comment">// 拦截资源请求并返回响应数据，返回null时WebView将继续加载资源</span></div><div class="line"><span class="function"><span class="keyword">public</span> WebResourceResponse <span class="title">shouldInterceptRequest</span><span class="params">(WebView view, String url)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 此方法添加于API21，调用于非UI线程</span></div><div class="line"><span class="comment">// 拦截资源请求并返回数据，返回null时WebView将继续加载资源</span></div><div class="line"><span class="meta">@TargetApi</span>(Build.VERSION_CODES.LOLLIPOP)</div><div class="line"><span class="function"><span class="keyword">public</span> WebResourceResponse <span class="title">shouldInterceptRequest</span><span class="params">(WebView view, WebResourceRequest request)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> shouldInterceptRequest(view, request.getUrl().toString());</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 页面(url)开始加载</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageStarted</span><span class="params">(WebView view, String url, Bitmap favicon)</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 页面(url)完成加载</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageFinished</span><span class="params">(WebView view, String url)</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 将要加载资源(url)</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLoadResource</span><span class="params">(WebView view, String url)</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 这个回调添加于API23，仅用于主框架的导航</span></div><div class="line"><span class="comment">// 通知应用导航到之前页面时，其遗留的WebView内容将不再被绘制。</span></div><div class="line"><span class="comment">// 这个回调可以用来决定哪些WebView可见内容能被安全地回收，以确保不显示陈旧的内容</span></div><div class="line"><span class="comment">// 它最早被调用，以此保证WebView.onDraw不会绘制任何之前页面的内容，随后绘制背景色或需要加载的新内容。</span></div><div class="line"><span class="comment">// 当HTTP响应body已经开始加载并体现在DOM上将在随后的绘制中可见时，这个方法会被调用。</span></div><div class="line"><span class="comment">// 这个回调发生在文档加载的早期，因此它的资源(css,和图像)可能不可用。</span></div><div class="line"><span class="comment">// 如果需要更细粒度的视图更新，查看 postVisualStateCallback(long, WebView.VisualStateCallback).</span></div><div class="line"><span class="comment">// 请注意这上边的所有条件也支持 postVisualStateCallback(long ,WebView.VisualStateCallback)</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageCommitVisible</span><span class="params">(WebView view, String url)</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 此方法废弃于API23</span></div><div class="line"><span class="comment">// 主框架加载资源时出错</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedError</span><span class="params">(WebView view, <span class="keyword">int</span> errorCode, String description, String failingUrl)</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 此方法添加于API23</span></div><div class="line"><span class="comment">// 加载资源时出错，通常意味着连接不到服务器</span></div><div class="line"><span class="comment">// 由于所有资源加载错误都会调用此方法，所以此方法应尽量逻辑简单</span></div><div class="line"><span class="meta">@TargetApi</span>(Build.VERSION_CODES.M)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedError</span><span class="params">(WebView view, WebResourceRequest request, WebResourceError error)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (request.isForMainFrame()) &#123;</div><div class="line">        onReceivedError(view, error.getErrorCode(), error.getDescription().toString(), request.getUrl().toString());</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 此方法添加于API23</span></div><div class="line"><span class="comment">// 在加载资源(iframe,image,js,css,ajax...)时收到了 HTTP 错误(状态码&gt;=400)</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedHttpError</span><span class="params">(WebView view, WebResourceRequest request, WebResourceResponse errorResponse)</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// 是否重新提交表单，默认不重发</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFormResubmission</span><span class="params">(WebView view, Message dontResend, Message resend)</span> </span>&#123;</div><div class="line">    dontResend.sendToTarget();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 通知应用可以将当前的url存储在数据库中，意味着当前的访问url已经生效并被记录在内核当中。</span></div><div class="line"><span class="comment">// 此方法在网页加载过程中只会被调用一次，网页前进后退并不会回调这个函数。</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doUpdateVisitedHistory</span><span class="params">(WebView view, String url, <span class="keyword">boolean</span> isReload)</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 加载资源时发生了一个SSL错误，应用必需响应(继续请求或取消请求)</span></div><div class="line"><span class="comment">// 处理决策可能被缓存用于后续的请求，默认行为是取消请求</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedSslError</span><span class="params">(WebView view, SslErrorHandler handler, SslError error)</span> </span>&#123;</div><div class="line">    handler.cancel();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 此方法添加于API21，在UI线程被调用</span></div><div class="line"><span class="comment">// 处理SSL客户端证书请求，必要的话可显示一个UI来提供KEY。</span></div><div class="line"><span class="comment">// 有三种响应方式：proceed()/cancel()/ignore()，默认行为是取消请求</span></div><div class="line"><span class="comment">// 如果调用proceed()或cancel()，Webview 将在内存中保存响应结果且对相同的"host:port"不会再次调用 onReceivedClientCertRequest</span></div><div class="line"><span class="comment">// 多数情况下，可通过KeyChain.choosePrivateKeyAlias启动一个Activity供用户选择合适的私钥</span></div><div class="line"><span class="meta">@TargetApi</span>(Build.VERSION_CODES.LOLLIPOP)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedClientCertRequest</span><span class="params">(WebView view, ClientCertRequest request)</span> </span>&#123;</div><div class="line">    request.cancel();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 处理HTTP认证请求，默认行为是取消请求</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedHttpAuthRequest</span><span class="params">(WebView view, HttpAuthHandler handler, String host, String realm)</span> </span>&#123;</div><div class="line">    handler.cancel();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 通知应用有个已授权账号自动登陆了</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedLoginRequest</span><span class="params">(WebView view, String realm, String account, String args)</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 给应用一个机会处理按键事件</span></div><div class="line"><span class="comment">// 如果返回true，WebView不处理该事件，否则WebView会一直处理，默认返回false</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideKeyEvent</span><span class="params">(WebView view, KeyEvent event)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 处理未被WebView消费的按键事件</span></div><div class="line"><span class="comment">// WebView总是消费按键事件，除非是系统按键或shouldOverrideKeyEvent返回true</span></div><div class="line"><span class="comment">// 此方法在按键事件分派时被异步调用</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onUnhandledKeyEvent</span><span class="params">(WebView view, KeyEvent event)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onUnhandledKeyEvent(view, event);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 通知应用页面缩放系数变化</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onScaleChanged</span><span class="params">(WebView view, <span class="keyword">float</span> oldScale, <span class="keyword">float</span> newScale)</span> </span>&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="WebChromeClient"><a href="#WebChromeClient" class="headerlink" title="WebChromeClient"></a>WebChromeClient</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 获得所有访问历史项目的列表，用于链接着色。</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getVisitedHistory</span><span class="params">(ValueCallback&lt;String[]&gt; callback)</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// &lt;video /&gt; 控件在未播放时，会展示为一张海报图，HTML中可通过它的'poster'属性来指定。</span></div><div class="line"><span class="comment">// 如果未指定'poster'属性，则通过此方法提供一个默认的海报图。</span></div><div class="line"><span class="function"><span class="keyword">public</span> Bitmap <span class="title">getDefaultVideoPoster</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 当全屏的视频正在缓冲时，此方法返回一个占位视图(比如旋转的菊花)。</span></div><div class="line"><span class="function"><span class="keyword">public</span> View <span class="title">getVideoLoadingProgressView</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 接收当前页面的加载进度</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onProgressChanged</span><span class="params">(WebView view, <span class="keyword">int</span> newProgress)</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 接收文档标题</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedTitle</span><span class="params">(WebView view, String title)</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 接收图标(favicon)</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedIcon</span><span class="params">(WebView view, Bitmap icon)</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Android中处理Touch Icon的方案</span></div><div class="line"><span class="comment">// http://droidyue.com/blog/2015/01/18/deal-with-touch-icon-in-android/index.html</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedTouchIconUrl</span><span class="params">(WebView view, String url, <span class="keyword">boolean</span> precomposed)</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 通知应用当前页进入了全屏模式，此时应用必须显示一个包含网页内容的自定义View</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onShowCustomView</span><span class="params">(View view, CustomViewCallback callback)</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 通知应用当前页退出了全屏模式，此时应用必须隐藏之前显示的自定义View</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onHideCustomView</span><span class="params">()</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// 显示一个alert对话框</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onJsAlert</span><span class="params">(WebView view, String url, String message, JsResult result)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 显示一个confirm对话框</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onJsConfirm</span><span class="params">(WebView view, String url, String message, JsResult result)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 显示一个prompt对话框</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onJsPrompt</span><span class="params">(WebView view, String url, String message, String defaultValue, JsPromptResult result)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 显示一个对话框让用户选择是否离开当前页面</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onJsBeforeUnload</span><span class="params">(WebView view, String url, String message, JsResult result)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// 指定源的网页内容在没有设置权限状态下尝试使用地理位置API。</span></div><div class="line"><span class="comment">// 从API24开始，此方法只为安全的源(https)调用，非安全的源会被自动拒绝</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onGeolocationPermissionsShowPrompt</span><span class="params">(String origin, GeolocationPermissions.Callback callback)</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 当前一个调用 onGeolocationPermissionsShowPrompt() 取消时，隐藏相关的UI。</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onGeolocationPermissionsHidePrompt</span><span class="params">()</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 通知应用打开新窗口</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreateWindow</span><span class="params">(WebView view, <span class="keyword">boolean</span> isDialog, <span class="keyword">boolean</span> isUserGesture, Message resultMsg)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 通知应用关闭窗口</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCloseWindow</span><span class="params">(WebView window)</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 请求获取取焦点</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRequestFocus</span><span class="params">(WebView view)</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 通知应用网页内容申请访问指定资源的权限(该权限未被授权或拒绝)</span></div><div class="line"><span class="meta">@TargetApi</span>(Build.VERSION_CODES.LOLLIPOP)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPermissionRequest</span><span class="params">(PermissionRequest request)</span> </span>&#123;</div><div class="line">    request.deny();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 通知应用权限的申请被取消，隐藏相关的UI。</span></div><div class="line"><span class="meta">@TargetApi</span>(Build.VERSION_CODES.LOLLIPOP)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPermissionRequestCanceled</span><span class="params">(PermissionRequest request)</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 为'&lt;input type="file" /&gt;'显示文件选择器，返回false使用默认处理</span></div><div class="line"><span class="meta">@TargetApi</span>(Build.VERSION_CODES.LOLLIPOP)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onShowFileChooser</span><span class="params">(WebView webView, ValueCallback&lt;Uri[]&gt; filePathCallback, FileChooserParams fileChooserParams)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 接收JavaScript控制台消息</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onConsoleMessage</span><span class="params">(ConsoleMessage consoleMessage)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="回调顺序"><a href="#回调顺序" class="headerlink" title="回调顺序"></a>回调顺序</h2><p>页面加载回调顺序：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">shouldOverrideUrlLoading</div><div class="line">onProgressChanged[<span class="number">10</span>]</div><div class="line">shouldInterceptRequest </div><div class="line">onProgressChanged[...]</div><div class="line">onPageStarted</div><div class="line">onProgressChanged[...]</div><div class="line">onLoadResource </div><div class="line">onProgressChanged[...]</div><div class="line">onReceivedTitle/onPageCommitVisible </div><div class="line">onProgressChanged[<span class="number">100</span>]</div><div class="line">onPageFinished</div><div class="line">onReceivedIcon</div></pre></td></tr></table></figure>
<p>资源加载回调：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">shouldInterceptRequest() -&gt; onLoadResource()</div></pre></td></tr></table></figure>
<p>发生重定向时回调：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">onPageStarted() -&gt; shouldOverrideUrlLoading()</div></pre></td></tr></table></figure>
<p>直接loadUrl的回调：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 无重定向</span></div><div class="line">onPageStarted() -&gt; onPageFinished()</div><div class="line"><span class="comment">// 有重定向，shouldOverrideUrlLoading 返回 true 时 onPageFinished 仍会执行</span></div><div class="line">onPageStarted() -&gt; redirection -&gt; ... -&gt; onPageFinished()</div></pre></td></tr></table></figure>
<p>用户点击链接的回调：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// shouldOverrideUrlLoading 返回 true 时不执行onPageStarted/onPageFinished</span></div><div class="line">shouldOverrideUrlLoading() -&gt; ...</div><div class="line"><span class="comment">// 无重定向</span></div><div class="line">shouldOverrideUrlLoading() -&gt; onPageStarted() -&gt; onPageFinished()</div><div class="line"><span class="comment">// 有重定向</span></div><div class="line">shouldOverrideUrlLoading() -&gt; onPageStarted() -&gt; redirection -&gt; ... -&gt; onPageFinished()</div></pre></td></tr></table></figure>
<p>后退/前进/刷新 时回调：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">onPageStarted() -&gt; onPageFinished()</div></pre></td></tr></table></figure>
<p>关于 <code>window.location</code> </p>
<p>假设从A页面跳转到B页面</p>
<ul>
<li>如果页面B中直接输出 <code>window.location=&quot;http://example.com&quot;</code>，那页面B不会被加入回退栈，回退将直接回到A页</li>
<li>如果页面B加载完成后，比如用<code>setTimeout</code>延迟了，那页面B会被加入回退栈，当回退到页面A时会再执行跳转，这会导致回退功能看起来不正常，需要快速回退两次才能回到A页面</li>
</ul>
<h2 id="视口-viewport"><a href="#视口-viewport" class="headerlink" title="视口(viewport)"></a>视口(viewport)</h2><blockquote>
<p><a href="https://developer.android.com/guide/webapps/targeting.html" target="_blank" rel="external">https://developer.android.com/guide/webapps/targeting.html</a><br><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Mobile/Viewport_meta_tag" target="_blank" rel="external">https://developer.mozilla.org/en-US/docs/Mozilla/Mobile/Viewport_meta_tag</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/@viewport" target="_blank" rel="external">https://developer.mozilla.org/zh-CN/docs/Web/CSS/@viewport</a></p>
</blockquote>
<p>视口是一个为网页提供绘图区域的矩形。   </p>
<p>你可以指定数个视口属性，比如尺寸和初始缩放系数(initial scale)。其中最重要的是<strong>视口宽度</strong>，它定义了网页水平方向的可用像素总数(可用的CSS像素数)。</p>
<p>多数 Android 上的网页浏览器(包括 Chrome)设置默认视口为一个大尺寸(被称为”<strong>wide viewport mode”</strong>，宽约 980px)。<br>也有许多浏览器默认会尽可能缩小以显示完整的视口宽度(被称为”<strong>overview mode</strong>“)。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 是否支持viewport属性，默认值 false</span></div><div class="line"><span class="comment">// 页面通过`&lt;meta name="viewport" ... /&gt;`自适应手机屏幕</span></div><div class="line"><span class="comment">// 当值为true且viewport标签不存在或未指定宽度时使用 wide viewport mode</span></div><div class="line">settings.setUseWideViewPort(<span class="keyword">true</span>);</div><div class="line"><span class="comment">// 是否使用overview mode加载页面，默认值 false</span></div><div class="line"><span class="comment">// 当页面宽度大于WebView宽度时，缩小使页面宽度等于WebView宽度</span></div><div class="line">settings.setLoadWithOverviewMode(<span class="keyword">true</span>);</div></pre></td></tr></table></figure>
<p>viewport 语法</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span></span></div><div class="line"><span class="tag">      <span class="attr">content</span>=<span class="string">"</span></span></div><div class="line"><span class="tag"><span class="string">          height = [pixel_value | "</span><span class="attr">device-height</span>"] ,</span></div><div class="line"><span class="tag">          <span class="attr">width</span> = <span class="string">[pixel_value</span> | "<span class="attr">device-width</span>"] ,</span></div><div class="line"><span class="tag">          <span class="attr">initial-scale</span> = <span class="string">float_value</span> ,</span></div><div class="line"><span class="tag">          <span class="attr">minimum-scale</span> = <span class="string">float_value</span> ,</span></div><div class="line"><span class="tag">          <span class="attr">maximum-scale</span> = <span class="string">float_value</span> ,</span></div><div class="line"><span class="tag">          <span class="attr">user-scalable</span> = <span class="string">[</span>"<span class="attr">yes</span>" | "<span class="attr">no</span>"]</span></div><div class="line"><span class="tag">          " /&gt;</span></div></pre></td></tr></table></figure>
<p>指定视口宽度精确匹配设备屏幕宽度同时禁用了缩放</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, user-scalable=no"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div></pre></td></tr></table></figure>
<p>通过WebView设置初始缩放(initial-scale)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 设置初始缩放百分比</span></div><div class="line"><span class="comment">// 0表示依赖于setUseWideViewPort和setLoadWithOverviewMode</span></div><div class="line"><span class="comment">// 100表示不缩放</span></div><div class="line">web.setInitialScale(<span class="number">0</span>)</div></pre></td></tr></table></figure>
<h2 id="管理-Cookies"><a href="#管理-Cookies" class="headerlink" title="管理 Cookies"></a>管理 Cookies</h2><blockquote>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Cookies" target="_blank" rel="external">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Cookies</a></p>
</blockquote>
<p>Cookie 是服务器发送到用户浏览器并保存在浏览器上的一块数据，它会在浏览器下一次发起请求时被携带并发送到服务器上。<br>可通过Cookie保存浏览信息来获得更轻松的在线体验，比如保持登录状态、记住偏好设置，并提供本地的相关内容。</p>
<p><strong>会话Cookie 与 持久Cookie</strong> </p>
<ul>
<li>会话cookie不需要指定Expires和Max-Age，浏览器关闭之后它会被自动删除。</li>
<li>持久cookie指定了Expires或Max-Age，会被存储到磁盘上，不会因浏览器而失效。</li>
</ul>
<p><strong>第一方Cookie 与 第三方Cookie</strong></p>
<p>每个Cookie都有与之关联的域，与页面域一样的就是第一方Cookie，不一样的就是第三方Cookie。 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 设置接收第三方Cookie</span></div><div class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;</div><div class="line">    CookieManager.getInstance().setAcceptThirdPartyCookies(vWeb, <span class="keyword">true</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>读取/写入/移除 Cookie</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 获取指定url关联的所有Cookie</span></div><div class="line"><span class="comment">// 返回值使用"Cookie"请求头格式："name=value; name2=value2; name3=value3"</span></div><div class="line">CookieManager.getInstance().getCookie(url);</div><div class="line"></div><div class="line"><span class="comment">// 为指定的url设置一个Cookie</span></div><div class="line"><span class="comment">// 参数value使用"Set-Cookie"响应头格式，参考：https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Set-Cookie</span></div><div class="line">CookieManager.getInstance().setCookie(url, value);</div><div class="line"></div><div class="line"><span class="comment">// 移除指定url下的指定Cookie</span></div><div class="line">CookieManager.getInstance().setCookie(url, cookieName + <span class="string">"="</span>);</div></pre></td></tr></table></figure>
<p><strong>webkit cookie 工具类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebkitCookieUtil</span> </span>&#123; </div><div class="line"></div><div class="line">    <span class="comment">// 移除指定url关联的所有cookie</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(String url)</span> </span>&#123;</div><div class="line">        CookieManager cm = CookieManager.getInstance();</div><div class="line">        <span class="keyword">for</span> (String cookie : cm.getCookie(url).split(<span class="string">"; "</span>)) &#123;</div><div class="line">            cm.setCookie(url, cookie.split(<span class="string">"="</span>)[<span class="number">0</span>] + <span class="string">"="</span>);</div><div class="line">        &#125;</div><div class="line">        flush();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// sessionOnly 为true表示移除所有会话cookie，否则移除所有cookie</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">boolean</span> sessionOnly)</span> </span>&#123;</div><div class="line">        CookieManager cm = CookieManager.getInstance();</div><div class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;</div><div class="line">            <span class="keyword">if</span> (sessionOnly) &#123;</div><div class="line">                cm.removeSessionCookies(<span class="keyword">null</span>);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                cm.removeAllCookies(<span class="keyword">null</span>);</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">if</span> (sessionOnly) &#123;</div><div class="line">                cm.removeSessionCookie();</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                cm.removeAllCookie();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        flush();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 写入磁盘</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">flush</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;</div><div class="line">            CookieManager.getInstance().flush();</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            CookieSyncManager.getInstance().sync();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>同步系统Cookie 与 Webkit Cookie</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 将系统级Cookie(比如`new URL(...).openConnection()`的Cookie) 同步到 WebView</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebkitCookieHandler</span> <span class="keyword">extends</span> <span class="title">CookieHandler</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = WebkitCookieHandler.class.getSimpleName();</div><div class="line">    <span class="keyword">private</span> CookieManager wcm;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WebkitCookieHandler</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.wcm = CookieManager.getInstance();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(URI uri, Map&lt;String, List&lt;String&gt;&gt; headers)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        <span class="keyword">if</span> ((uri == <span class="keyword">null</span>) || (headers == <span class="keyword">null</span>)) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        String url = uri.toString();</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (String headerKey : headers.keySet()) &#123;</div><div class="line">            <span class="keyword">if</span> ((headerKey == <span class="keyword">null</span>) || !(headerKey.equalsIgnoreCase(<span class="string">"set-cookie2"</span>) || headerKey.equalsIgnoreCase(<span class="string">"set-cookie"</span>))) &#123;</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">for</span> (String headerValue : headers.get(headerKey)) &#123;</div><div class="line">                Log.e(TAG, headerKey + <span class="string">": "</span> + headerValue);</div><div class="line">                <span class="keyword">this</span>.wcm.setCookie(url, headerValue);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> Map&lt;String, List&lt;String&gt;&gt; get(URI uri, Map&lt;String, List&lt;String&gt;&gt; headers) <span class="keyword">throws</span> IOException &#123;</div><div class="line">        <span class="keyword">if</span> ((uri == <span class="keyword">null</span>) || (headers == <span class="keyword">null</span>)) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Argument is null"</span>);</div><div class="line">        &#125;</div><div class="line">        String url = uri.toString();</div><div class="line"></div><div class="line">        String cookie = <span class="keyword">this</span>.wcm.getCookie(url);</div><div class="line">        Log.e(TAG, <span class="string">"cookie: "</span> + cookie);</div><div class="line">        <span class="keyword">if</span> (cookie != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">return</span> Collections.singletonMap(<span class="string">"Cookie"</span>, Arrays.asList(cookie));</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> Collections.emptyMap();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="缓存-Cache"><a href="#缓存-Cache" class="headerlink" title="缓存(Cache)"></a>缓存(Cache)</h2><p>设置缓存模式</p>
<ul>
<li><code>WebSettings.LOAD_DEFAULT</code> 根据cache-control决定是否从网络上取数据</li>
<li><code>WebSettings.LOAD_CACHE_ELSE_NETWORK</code> 无网，离线加载，优先加载缓存(即使已经过期) </li>
<li><code>WebSettings.LOAD_NO_CACHE</code> 仅从网络加载</li>
<li><code>WebSettings.LOAD_CACHE_ONLY</code> 仅从缓存加载</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 网络正常时根据cache-control决定是否从网络上取数据 </span></div><div class="line"><span class="keyword">if</span> (isNetworkConnected(mActivity)) &#123;</div><div class="line">    settings.setCacheMode(WebSettings.LOAD_DEFAULT); </div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    settings.setCacheMode(WebSettings.LOAD_CACHE_ELSE_NETWORK); </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>清除缓存</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 传入true表示同时内存与磁盘，false表示仅清除内存</span></div><div class="line"><span class="comment">// 由于内核缓存是全局的因此这个方法不仅仅针对webview而是针对整个应用程序</span></div><div class="line">web.clearCache(<span class="keyword">true</span>);</div></pre></td></tr></table></figure>
<h2 id="预加载-Preload"><a href="#预加载-Preload" class="headerlink" title="预加载(Preload)"></a>预加载(Preload)</h2><p>一个简单的预加载示例(shouldInterceptRequest)<br>点击 <code>assets/demo.xml</code> 里的链接”hello”时会加载本地的 <code>assets/hello.html</code></p>
<p>assets/demo.xml</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://demo.com/assets/hello.html"</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>assets/hello.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">hello world!</div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>重载 shouldInterceptRequest</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> WebResourceResponse <span class="title">shouldInterceptRequest</span><span class="params">(WebView view, String url)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> preload(<span class="string">"assets/"</span>, url);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function">WebResourceResponse <span class="title">preload</span><span class="params">(String path, String url)</span> </span>&#123; </div><div class="line">    <span class="keyword">if</span> (!url.contains(path)) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">    String local = url.replaceFirst(<span class="string">"^http.*"</span> + path, <span class="string">""</span>); </div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        InputStream is = getApplicationContext().getAssets().open(local);</div><div class="line">        String ext = MimeTypeMap.getFileExtensionFromUrl(local);</div><div class="line">        String mimeType = MimeTypeMap.getSingleton().getMimeTypeFromExtension(ext);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WebResourceResponse(mimeType, <span class="string">"UTF-8"</span>, is);</div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="与Javascript交互"><a href="#与Javascript交互" class="headerlink" title="与Javascript交互"></a>与Javascript交互</h2><p>启用Javascript</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 是否支持Javascript，默认值false</span></div><div class="line">settings.setJavaScriptEnabled(<span class="keyword">true</span>);</div></pre></td></tr></table></figure>
<p>注入对象到Javascript </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 注入对象'jsobj'，在网页中通过`jsobj.say(...)`调用</span></div><div class="line">web.addJavascriptInterface(<span class="keyword">new</span> JSObject(), <span class="string">"jsobj"</span>)</div></pre></td></tr></table></figure>
<p>在API17后支持白名单，只有添加了<code>@JavascriptInterface</code>注解的方法才会注入JS  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JSObject</span> </span>&#123;</div><div class="line">    <span class="meta">@JavascriptInterface</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say</span><span class="params">(String words)</span> </span>&#123;</div><div class="line">      <span class="comment">// todo</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>移除已注入Javascript的对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">web.removeJavascriptInterface(<span class="string">"jsobj"</span>)</div></pre></td></tr></table></figure>
<p>执行JS表达式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 弹出提示框</span></div><div class="line">web.loadUrl(<span class="string">"javascript:alert('hello')"</span>);</div><div class="line"><span class="comment">// 调用注入的jsobj.say方法</span></div><div class="line">web.loadUrl(<span class="string">"javascript:jsobj.say('hello')"</span>);</div></pre></td></tr></table></figure>
<p>在API19后可异步执行JS表达式，并通过回调返回值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;</div><div class="line">    vWeb.evaluateJavascript(<span class="string">"111+222"</span>, <span class="keyword">new</span> ValueCallback&lt;String&gt;() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceiveValue</span><span class="params">(String value)</span> </span>&#123;</div><div class="line">            <span class="comment">// value =&gt; "333"</span></div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="地理位置-Geolocation"><a href="#地理位置-Geolocation" class="headerlink" title="地理位置(Geolocation)"></a>地理位置(Geolocation)</h2><blockquote>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Geolocation/Using_geolocation" target="_blank" rel="external">https://developer.mozilla.org/zh-CN/docs/Web/API/Geolocation/Using_geolocation</a></p>
</blockquote>
<p>需要以下权限</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.INTERNET"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.ACCESS_FINE_LOCATION"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.ACCESS_COARSE_LOCATION"</span>/&gt;</span></div></pre></td></tr></table></figure>
<p>默认可用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">settings.setGeolocationEnabled(<span class="keyword">true</span>);</div></pre></td></tr></table></figure>
<p>当H5调用地理位置API时，会先通过<code>WebChromeClient.onGeolocationPermissionsShowPrompt</code>申请授权</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 指定源的网页内容在没有设置权限状态下尝试使用地理位置API。 </span></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onGeolocationPermissionsShowPrompt</span><span class="params">(String origin, GeolocationPermissions.Callback callback)</span> </span>&#123;</div><div class="line">    <span class="keyword">boolean</span> allow = <span class="keyword">true</span>;   <span class="comment">// 是否允许origin使用定位API</span></div><div class="line">    <span class="keyword">boolean</span> retain = <span class="keyword">false</span>; <span class="comment">// 内核是否记住这次制授权</span></div><div class="line">    callback.invoke(origin, <span class="keyword">true</span>, <span class="keyword">false</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 之前调用 onGeolocationPermissionsShowPrompt() 申请的授权被取消时，隐藏相关的UI。</span></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onGeolocationPermissionsHidePrompt</span><span class="params">()</span> </span>&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>注：从API24开始，仅支持安全源(https)的请求，非安全源的请求将自动拒绝且不调用 onGeolocationPermissionsShowPrompt 与 onGeolocationPermissionsHidePrompt</p>
<h2 id="弹框-alert-confirm-prompt-onbeforeunload"><a href="#弹框-alert-confirm-prompt-onbeforeunload" class="headerlink" title="弹框(alert/confirm/prompt/onbeforeunload)"></a>弹框(alert/confirm/prompt/onbeforeunload)</h2><p>在javascript中使用 alert/confirm/prompt 会弹出对话框，可通过重载 WebChromeClient 的下列方法控制弹框的交互，比如替换系统默认的对话框或屏蔽这些对话框  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onJsAlert</span><span class="params">(WebView view, String url, String message, JsResult result)</span> </span>&#123;</div><div class="line">    <span class="comment">// 这里处理交互逻辑</span></div><div class="line">    <span class="comment">// result.cancel(); 表示用户取消了操作(点击了取消按钮)</span></div><div class="line">    <span class="comment">// result.confirm(); 表示用户确认了操作(点击了确认按钮)</span></div><div class="line">    <span class="comment">// ...</span></div><div class="line">    <span class="comment">// 返回true表示自已处理，返回false表示由系统处理</span></div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>; </div><div class="line">&#125; </div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onJsConfirm</span><span class="params">(WebView view, String url, String message, JsResult result)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125; </div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onJsPrompt</span><span class="params">(WebView view, String url, String message, String defaultValue, JsPromptResult result)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onJsBeforeUnload</span><span class="params">(WebView view, String url, String message, JsResult result)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="全屏-Fullscreen"><a href="#全屏-Fullscreen" class="headerlink" title="全屏(Fullscreen)"></a>全屏(Fullscreen)</h2><blockquote>
<p>Fullscreen API<br><a href="https://developer.mozilla.org/zh-CN/docs/DOM/Using_fullscreen_mode" target="_blank" rel="external">https://developer.mozilla.org/zh-CN/docs/DOM/Using_fullscreen_mode</a></p>
</blockquote>
<ul>
<li>当H5请求全屏时，会回调 <code>WebChromeClient.onShowCustomView</code> 方法</li>
<li>当H5退出全屏时，会回调 <code>WebChromeClient.onHideCustomView</code> 方法 </li>
</ul>
<p>1.manifest</p>
<p>自己处理屏幕尺寸方向的变化(切换屏幕方向时不重建activity)<br>WebView播放视频需要开启硬件加速</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">activity</span></span></div><div class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">".WebViewActivity"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:configChanges</span>=<span class="string">"orientation|screenSize"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:hardwareAccelerated</span>=<span class="string">"true"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:screenOrientation</span>=<span class="string">"portrait"</span> /&gt;</span></div></pre></td></tr></table></figure>
<p>2.页面布局</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></div><div class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/toolbar"</span></span></div><div class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">"@style/Toolbar.Back"</span>/&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">FrameLayout</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">WebView</span></span></div><div class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/web"</span></span></div><div class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>/&gt;</span></div><div class="line"></div><div class="line">        ...</div><div class="line">    <span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>3.处理全屏回调 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">CustomViewCallback mCallback;</div><div class="line">View vCustom;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onShowCustomView</span><span class="params">(View view, CustomViewCallback callback)</span> </span>&#123;</div><div class="line">    setFullscreen(<span class="keyword">true</span>);</div><div class="line">    vCustom = view;</div><div class="line">    mCallback = callback;</div><div class="line">    <span class="keyword">if</span> (vCustom != <span class="keyword">null</span>) &#123;</div><div class="line">        ViewGroup parent = (ViewGroup) vWeb.getParent();</div><div class="line">        parent.addView(vCustom);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onHideCustomView</span><span class="params">()</span> </span>&#123;</div><div class="line">    setFullscreen(<span class="keyword">false</span>);</div><div class="line">    <span class="keyword">if</span> (vCustom != <span class="keyword">null</span>) &#123;</div><div class="line">        ViewGroup parent = (ViewGroup) vWeb.getParent();</div><div class="line">        parent.removeView(vCustom);</div><div class="line">        vCustom = <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (mCallback != <span class="keyword">null</span>) &#123;</div><div class="line">        mCallback.onCustomViewHidden();</div><div class="line">        mCallback = <span class="keyword">null</span>;</div><div class="line">    &#125; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>4.设置全屏，切换屏幕方向</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">setFullscreen</span><span class="params">(<span class="keyword">boolean</span> fullscreen)</span> </span>&#123; </div><div class="line">    <span class="keyword">if</span> (fullscreen) &#123;</div><div class="line">        getWindow().clearFlags(WindowManager.LayoutParams.FLAG_FORCE_NOT_FULLSCREEN);</div><div class="line">        getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN, WindowManager.LayoutParams.FLAG_FULLSCREEN);</div><div class="line">        vToolbar.setVisibility(View.GONE);</div><div class="line">        vWeb.setVisibility(View.GONE);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        getWindow().clearFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN);</div><div class="line">        getWindow().setFlags(WindowManager.LayoutParams.FLAG_FORCE_NOT_FULLSCREEN, WindowManager.LayoutParams.FLAG_FORCE_NOT_FULLSCREEN);</div><div class="line">        vToolbar.setVisibility(View.VISIBLE);</div><div class="line">        vWeb.setVisibility(View.VISIBLE);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (getResources().getConfiguration().orientation == Configuration.ORIENTATION_PORTRAIT) &#123;</div><div class="line">        setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_LANDSCAPE);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_PORTRAIT);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="内存泄漏"><a href="#内存泄漏" class="headerlink" title="内存泄漏"></a>内存泄漏</h2><p>直接 new WebView 并传入 application context 代替在 XML 里面声明以防止 activity 引用被滥用，能解决90+%的 WebView 内存泄漏。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">vWeb =  <span class="keyword">new</span> WebView(getContext().getApplicationContext());</div><div class="line">container.addView(vWeb);</div></pre></td></tr></table></figure>
<p>销毁 WebView</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (vWeb != <span class="keyword">null</span>) &#123;</div><div class="line">    vWeb.setWebViewClient(<span class="keyword">null</span>);</div><div class="line">    vWeb.setWebChromeClient(<span class="keyword">null</span>);</div><div class="line">    vWeb.loadDataWithBaseURL(<span class="keyword">null</span>, <span class="string">""</span>, <span class="string">"text/html"</span>, <span class="string">"utf-8"</span>, <span class="keyword">null</span>);</div><div class="line">    vWeb.clearHistory();</div><div class="line"></div><div class="line">    ((ViewGroup) vWeb.getParent()).removeView(vWeb);</div><div class="line">    vWeb.destroy();</div><div class="line">    vWeb = <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://developer.android.com/reference/android/webkit/package-summary.html" target="_blank" rel="external">https://developer.android.com/reference/android/webkit/package-summary.html</a></p>
<p>Fullscreen API 全屏显示网页<br><a href="http://calefy.org/2012/06/03/fullscreen-web-page-width-fullscreen-api.html" target="_blank" rel="external">http://calefy.org/2012/06/03/fullscreen-web-page-width-fullscreen-api.html</a></p>
<p>WebView实现全屏播放的一种方法<br><a href="https://segmentfault.com/a/1190000007561455" target="_blank" rel="external">https://segmentfault.com/a/1190000007561455</a></p>
<p>第一方Cookie和第三方Cookie区别<br><a href="https://www.biaodianfu.com/first-party-cookie-and-third-party-cookie.html" target="_blank" rel="external">https://www.biaodianfu.com/first-party-cookie-and-third-party-cookie.html</a> </p>
<p>Android WebView的Js对象注入漏洞解决方案<br><a href="http://blog.csdn.net/leehong2005/article/details/11808557" target="_blank" rel="external">http://blog.csdn.net/leehong2005/article/details/11808557</a> </p>
<p>Android安全开发之WebView中的地雷<br><a href="http://yaq.qq.com/blog/10" target="_blank" rel="external">http://yaq.qq.com/blog/10</a></p>
<p>Android WebView：性能优化不得不说的事<br><a href="https://juejin.im/entry/57d6434067f3560057e50b20" target="_blank" rel="external">https://juejin.im/entry/57d6434067f3560057e50b20</a></p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>欢迎打赏，谢谢支持～</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>Donate</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/qrcode/wechatpay.png" alt="ezy WeChat Pay"/>
        <p>WeChat Pay</p>
      </div>
    

    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/android/" rel="tag"># android</a>
          
            <a href="/tags/cookie/" rel="tag"># cookie</a>
          
            <a href="/tags/fullscreen/" rel="tag"># fullscreen</a>
          
            <a href="/tags/javascript/" rel="tag"># javascript</a>
          
            <a href="/tags/webview/" rel="tag"># webview</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/p/20170421/pki-ca-cert/" rel="next" title="公钥证书相关概念">
                <i class="fa fa-chevron-left"></i> 公钥证书相关概念
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/p/20170517/spec-naming-java/" rel="prev" title="Java命名规范">
                Java命名规范 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        
<div class="social-share"></div>

<!--  css & js -->
<link rel="stylesheet" href="https://unpkg.com/social-share.js@1.0.16/dist/css/share.min.css">
<script src="https://unpkg.com/social-share.js@1.0.16/dist/js/social-share.min.js"></script>

      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">

    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
    const gitalk = new Gitalk({
      clientID: '04e001e904d3e8049513',
      clientSecret: 'db54df563540700ccd40cca2e3694c9ab9bb65d4',
      repo: 'czy1121.github.com',
      owner: 'czy1121',
      admin: ['czy1121'],
      // facebook-like distraction free mode
      distractionFreeMode: false
    })

    gitalk.render('gitalk-container')
    </script>
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="ezy" />
          <p class="site-author-name" itemprop="name">ezy</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">27</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">69</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/czy1121" target="_blank" title="GitHub">
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/users/1e52f82e7ca7" target="_blank" title="简书">
                  
                    
                      简书
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://gold.xitu.io/user/578637c2c4c971005c4ff063" target="_blank" title="掘金">
                  
                    
                      掘金
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#相关API"><span class="nav-number">1.</span> <span class="nav-text">相关API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#相关类介绍"><span class="nav-number">1.1.</span> <span class="nav-text">相关类介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WebView"><span class="nav-number">1.2.</span> <span class="nav-text">WebView</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WebSettings"><span class="nav-number">1.3.</span> <span class="nav-text">WebSettings</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WebViewClient"><span class="nav-number">1.4.</span> <span class="nav-text">WebViewClient</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WebChromeClient"><span class="nav-number">1.5.</span> <span class="nav-text">WebChromeClient</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#回调顺序"><span class="nav-number">2.</span> <span class="nav-text">回调顺序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#视口-viewport"><span class="nav-number">3.</span> <span class="nav-text">视口(viewport)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#管理-Cookies"><span class="nav-number">4.</span> <span class="nav-text">管理 Cookies</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#缓存-Cache"><span class="nav-number">5.</span> <span class="nav-text">缓存(Cache)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#预加载-Preload"><span class="nav-number">6.</span> <span class="nav-text">预加载(Preload)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#与Javascript交互"><span class="nav-number">7.</span> <span class="nav-text">与Javascript交互</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#地理位置-Geolocation"><span class="nav-number">8.</span> <span class="nav-text">地理位置(Geolocation)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#弹框-alert-confirm-prompt-onbeforeunload"><span class="nav-number">9.</span> <span class="nav-text">弹框(alert/confirm/prompt/onbeforeunload)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#全屏-Fullscreen"><span class="nav-number">10.</span> <span class="nav-text">全屏(Fullscreen)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#内存泄漏"><span class="nav-number">11.</span> <span class="nav-text">内存泄漏</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-number">12.</span> <span class="nav-text">参考</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ezy</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  

  





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  
  <script type="text/javascript" src="/js/src/exturl.js?v=5.1.2"></script>


</body>
</html>
